## 项目概述
- **名称**：UserCenter
- **功能**：提供用户注册、登录、查询（支持条件过滤）和列表（支持分页和排序）功能。
- **语言和版本**：使用 Go 1.23.1，通过 `go mod` 管理依赖。

## 功能要求
1. **核心功能**：
   - **注册**：用户注册，包含用户名、邮箱、密码等字段，支持密码加密（如 bcrypt）。
   - **登录**：用户登录，返回 JWT 令牌。
   - **查询**：根据条件（如 ID、邮箱）查询用户信息。
   - **列表**：返回用户列表，支持分页和排序。
2. **健康检查**：
   - 提供健康检查端点（如 `/health`），用于服务状态监控。
3. **输入校验**：
   - 对所有 API 请求的输入参数进行校验（如必填字段、格式验证）。
4. **速率限制**：
   - 实现 API 速率限制，防止滥用。
5. **CORS**：
   - 支持跨域资源共享（CORS），允许前端跨域访问，配置需安全（限制允许域名）。
6. **国际化**：
   - 集成国际化支持，API 响应和错误信息支持多语言（如中文、英文），推荐使用 go-i18n 库。
7. **优雅停机**：
   - 实现优雅停机（Graceful Shutdown），确保服务在接收终止信号（如 SIGINT、SIGTERM）时完成当前请求并安全关闭。
8. **Request ID 传递**：
   - 使用 Context 上下文传递 Request ID，用于日志和链路追踪，确保每个请求可追溯。

## 技术要求
1. **Web 框架**：
   - 使用 **Gin** 框架处理 HTTP 请求。
2. **API 文档**：
   - 使用 **Swagger** 自动生成和维护 API 文档，生成 OpenAPI 3.0 规范。
3. **依赖注入**：
   - 使用 **Wire** 进行依赖注入，管理服务依赖。
4. **数据库**：
   - 使用 **GORM** 连接 **PostgreSQL**，存储用户核心数据（如用户名、邮箱、密码）。
   - 集成 **MongoDB**，用于辅助数据存储（如日志、会话数据）。
   - 使用 **Goose** 进行数据库迁移，管理 PostgreSQL 数据库 schema 的版本控制和演进。
5. **缓存**：
   - 使用 **Redis** 进行缓存以提升性能。
6. **消息队列**：
   - 集成 **Kafka** 消费上游消息（例如，用户注册事件），需定义主题和消息格式。
7. **异步任务**：
   - 使用 **Asynq** 处理异步任务（如发送注册确认邮件）。
8. **日志**：
   - 实现多级别日志（debug、info、warn、error），推荐使用 **Zap**，支持 JSON 格式输出，日志包含 Request ID。
9. **监控与可观测性**：
   - 集成 **Prometheus** 用于监控关键指标（如请求延迟、错误率）。
   - 实现分布式追踪，使用 **OpenTelemetry** 支持链路追踪，兼容 Jaeger 或其他后端，追踪数据包含 Request ID。
10. **认证**：
    - 使用 **JWT**（JSON Web Token）实现用户认证。
11. **错误处理**：
    - 实现统一的错误处理策略，定义标准错误类型和 HTTP 响应格式（如 JSON 格式，包含错误码和消息）。
12. **配置**：
    - 支持 **YAML** 配置文件，加载顺序为：本地文件 -> 环境变量 -> 默认值。

## 开发和部署要求
1. **构建与代码校验**：
   - 提供 **Makefile**，包含常用任务（如 build、test、lint、run、migrate）。
   - 使用 **golangci-lint** 确保代码符合 Go 编码规范。
2. **测试**：
   - 为每个核心功能（注册、登录、查询、列表）生成 **单元测试**，覆盖 handlers、services 和 repositories。
   - 推荐测试覆盖率目标为 80% 或以上。
3. **文档**：
   - 提供 **README.md**，包含：
     - 项目简介。
     - 依赖和前提条件。
     - 安装、配置和运行说明。
     - API 使用示例（包括 Swagger 文档访问方式）。
     - 国际化支持说明。
     - 优雅停机和 Request ID 相关说明。
4. **容器化**：
   - 提供 **Dockerfile**，支持多阶段构建，优化镜像大小和安全性。
   - 确保支持生产环境部署，包含优雅停机配置。
5. **版本控制**：
   - 提供 `.gitignore` 文件，忽略编译产物、日志文件等。

## 项目结构
- 遵循 **标准 Go 项目布局**（如 `cmd`、`internal`、`pkg`、`api` 等）。
- 提供完整的目录结构，无需具体代码实现，仅关注文件和文件夹的组织。
- 目录结构需模块化、可扩展，分离关注点（handlers、services、repositories 等）。
- 包含以下占位文件：
  - Go 源文件（如 main.go、handlers、services、models）。
  - 配置文件（config.yaml）。
  - 数据库迁移文件（Goose 迁移脚本）。
  - Swagger 配置文件（openapi.yaml）。
  - Makefile。
  - Dockerfile。
  - README.md。
  - 单元测试文件。
  - golangci-lint 配置文件。
- 文件名需清晰反映其功能，目录结构支持所有指定技术。

## 附加要求
- **代码规范**：代码必须通过 **golangci-lint** 校验，遵循 Go 标准编码实践。
- **安全性**：
  - 密码需加密存储（如使用 bcrypt）。
  - 实现速率限制和输入校验以防止常见攻击。
  - CORS 配置需安全，限制允许的域名。
- **可扩展性**：
  - 目录结构支持未来功能扩展（如用户角色管理、密码重置）。
  - Kafka 消费者支持多主题消费。
- **国际化**：
  - 使用 go-i18n 实现多语言支持，错误信息和 API 响应可动态切换语言。
- **优雅停机**：
  - 服务支持优雅停机，确保在终止时完成当前请求并释放资源。
- **Request ID**：
  - 每个请求通过 Context 传递唯一的 Request ID，记录在日志和链路追踪中。

## 交付内容
- 完整的项目目录结构（文件和文件夹），附带每个文件/文件夹的用途简要描述。
- 确保支持所有技术（Gin、Swagger、GORM、MongoDB、Goose、Redis、Kafka、Asynq、Prometheus、OpenTelemetry、JWT、Zap）。
- 提供占位文件，无需具体代码实现，但文件名和目录组织需逻辑清晰。
- **README.md** 需专业、清晰，包含国际化支持、API 文档访问方式、优雅停机和 Request ID 相关说明。
- **Dockerfile** 需优化为生产环境，包含多阶段构建和优雅停机支持。
- **Makefile** 需包含数据库迁移任务（使用 Goose）。

## 备注
- **数据库用途**：PostgreSQL 存储用户核心数据（如用户名、邮箱、密码），MongoDB 存储辅助数据（如日志或会话）。
- **Kafka 消息**：假设消费用户相关事件（如注册事件），需定义主题。
- **日志库**：推荐 Zap，支持 JSON 格式输出，包含 Request ID。
- **链路追踪**：推荐 OpenTelemetry，兼容 Jaeger 或其他后端，追踪数据包含 Request ID。
- **错误处理**：统一错误响应格式（如 JSON 格式，包含错误码和消息）。
- **项目结构**：需模块化，支持未来扩展（如添加新功能或服务）。