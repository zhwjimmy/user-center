# User 功能清单

1. 用户注册
   - 接口：POST /api/v1/users/register
   - DTO: dto.RegisterRequest, dto.RegisterResponse
   - 服务：AuthService.Register, UserService.CreateUser
   - 数据库：users 表（migrations/001_create_users_table.sql）
   - 事件：注册事件（Kafka）

2. 用户登录/登出
   - 接口：POST /api/v1/users/login
   - DTO: dto.LoginRequest, dto.LoginResponse
   - 服务：AuthService.Login
   - 事件：登录事件（Kafka）

3. 用户信息查询
   - 接口：GET /api/v1/users/{id}, GET /api/v1/users/me
   - DTO: dto.UserResponse
   - 服务：UserService.GetUserByID, UserService.GetUserByEmail, UserService.GetUserByUsername
   - 数据库：users 表

4. 用户信息修改
   - 接口：PUT /api/v1/users/me
   - DTO: dto.UpdateUserRequest
   - 服务：UserService.UpdateUser
   - 数据库：users 表

5. 用户密码修改与重置
   - 接口：PUT /api/v1/users/me/password
   - DTO: dto.ChangePasswordRequest
   - 服务：AuthService.ChangePassword
   - 事件：密码变更事件（Kafka）

6. 用户会话管理
   - JWT 鉴权，token 生成与刷新：AuthService.Login, AuthService.RefreshToken
   - 中间件：authMiddleware.RequireAuth

7. 用户权限校验
   - 字段：users.is_admin, is_active
   - 中间件：authMiddleware.RequireAuth, RequireActiveUser, AdminOnly

8. 用户事件通知（如注册、登录等）
   - 事件发布：EventService.PublishUserRegisteredEvent, PublishUserLoggedInEvent, PublishUserPasswordChangedEvent
   - Kafka 消费：internal/kafka/consumer/handler.go

9. 用户缓存与数据库交互
   - 缓存：internal/cache/redis.go
   - 数据库操作：internal/repository/user.go

10. 用户相关的 API 接口
   - 详见 internal/handler/user.go，所有用户相关接口均有注释和 OpenAPI 标注

---

## users 表结构（简要）
- id UUID 主键
- username VARCHAR(50) 唯一
- email VARCHAR(255) 唯一
- password_hash VARCHAR(255)
- first_name, last_name, phone, avatar_url
- is_active, is_admin, email_verified, phone_verified
- last_login_at, created_at, updated_at

详见：migrations/001_create_users_table.sql

> 如有遗漏，可在后续迭代中补充完善。 